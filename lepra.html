<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–û—Ö–æ—Ç–∞ –Ω–∞ –õ–µ–ø—Ä–µ–∫–æ–Ω–∞</title>
    <style>
        .static-content { 
            border-bottom: 2px solid #2ecc71; 
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #dynamic-content {
            margin: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        input, button { 
            padding: 12px;
            margin: 8px;
            border: 1px solid #2ecc71;
            border-radius: 4px;
        }
        button {
            background: #2ecc71;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="static-content">
            <h1>üïµÔ∏è‚ôÇÔ∏è –û—Ö–æ—Ç–∞ –Ω–∞ –õ–µ–ø—Ä–µ–∫–æ–Ω–∞: –ö–∞–º–Ω–∏ –î–æ–±—Ä–æ—Ç–Ω–æ—Å—Ç–∏</h1>
            <p class="alex">üîÆ –ê–ª–µ–∫—Å: "–û—Ä–∞–∫—É–ª –≥–æ–≤–æ—Ä–∏—Ç: ¬´–¢—Ä–∏ —à–∞–≥–∞ –≤–ø–µ—Ä—ë–¥, –¥–≤–∞ –Ω–∞–∑–∞–¥...¬ª"</p>
        </div>

        <div id="dynamic-content"></div>

        <form id="userForm">
            <input type="text" id="userName" placeholder="–í–∞—à–µ –∏–º—è" required>
            <input type="number" id="userAge" placeholder="–í–∞—à –≤–æ–∑—Ä–∞—Å—Ç" required>
            <button type="button" onclick="initStory()">–ù–∞—á–∞—Ç—å –∫–≤–µ—Å—Ç üåü</button>
        </form>
    </div>

    <script>
        // ======================
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        // ======================
        const API_KEY = 'sk-27969cf26a24400dbed7a207cf18493d'; // üîí –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –†–ï–ê–õ–¨–ù–´–ô –ö–õ–Æ–ß
        const CORS_PROXY = 'https://cors-anywhere.herokuapp.com/'; // üåê –ü—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ–∫—Å–∏

        // ======================
        // –°–ò–°–¢–ï–ú–ê –ì–ï–ù–ï–†–ê–¶–ò–ò
        // ======================
        function generateSeed(name, age) {
            let hash = 0;
            const combined = name + age.toString();
            for (let i = 0; i < combined.length; i++) {
                hash = (hash << 5) - hash + combined.charCodeAt(i);
                hash |= 0;
            }
            return Math.abs(hash);
        }

        const STATIC_CONFIG = {
            characters: {
                Alex: {
                    traits: "üî≠ –†–∞—Ü–∏–æ–Ω–∞–ª–∏—Å—Ç –≤ –æ—á–∫–∞—Ö, –≤–µ—Ä–∏—Ç –≤ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
                    phrases: [
                        "‚öõÔ∏è –≠—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –∑–∞–∫–æ–Ω—ã —Ñ–∏–∑–∏–∫–∏!", 
                        "ü§ñ –û—Ä–∞–∫—É–ª –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—à–∏–±–∞–µ—Ç—Å—è"
                    ]
                },
                Regina: {
                    traits: "üìñ –î–µ–≤–æ—á–∫–∞ —Å –±–ª–æ–∫–Ω–æ—Ç–æ–º —à–∏—Ñ—Ä–æ–≤",
                    phrases: [
                        "üîç –î–æ–≤–µ—Ä—è–π, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π", 
                        "üïµÔ∏è‚ôÄÔ∏è –ó–¥–µ—Å—å —á—Ç–æ-—Ç–æ –Ω–µ —Å—Ö–æ–¥–∏—Ç—Å—è..."
                    ]
                }
            },
            locations: [
                "üè† –î–æ–º —Å —Ä—ã–∂–∏–º–∏ —Å—Ç–∞–≤–Ω—è–º–∏",
                "‚è≥ –õ–∞–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏",
                "üêö –ü–ª—è–∂ —Ä–∞–∫—É—à–µ–∫"
            ]
        };

        // ======================
        // API –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø
        // ======================
        async function generateStoryContent(prompt) {
            try {
                const apiUrl = CORS_PROXY + 'https://api.deepseek.com/v1/chat/completions';
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{ 
                            role: "user", 
                            content: prompt + "\n\n–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: HTML —Å —ç–º–æ–¥–∑–∏, –±–µ–∑ Markdown"
                        }],
                        temperature: 0.7,
                        max_tokens: 600
                    })
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                const content = data.choices[0].message.content;

                if (!validateContent(content)) {
                    return "<p>üö´ –ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã</p>";
                }
                
                return content;

            } catch (error) {
                console.error('üö® –û—à–∏–±–∫–∞:', error);
                return `<p>‚ö†Ô∏è –û—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        }

        // ======================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ======================
        function buildPrompt(seed) {
            const elements = {
                time: ["üåÖ –†–∞—Å—Å–≤–µ—Ç", "üåï –ü–æ–ª–Ω–æ—á—å", "üåá –°—É–º–µ—Ä–∫–∏"][seed % 3],
                symbol: ["üîë –ö–ª—é—á-–ú—ë–±–∏—É—Å", "ü™û –ó–µ—Ä–∫–∞–ª–æ", "üåÄ –°–ø–∏—Ä–∞–ª—å"][seed % 3],
                obstacle: ["üë£ –ó–∞–≥–∞–¥–æ—á–Ω—ã–µ —Å–ª–µ–¥—ã", "üå´Ô∏è –ò—Å—á–µ–∑–∞—é—â–∞—è —Ç—Ä–æ–ø–∞", "üóø –ì–æ–≤–æ—Ä—è—â–∏–π –∫–∞–º–µ–Ω—å"][seed % 3]
            };

            return `–ù–∞–ø–∏—à–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∏—Å—Ç–æ—Ä–∏–∏ –≤ —Å—Ç–∏–ª–µ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∞–ª–∏–∑–º–∞:
                - –ü–µ—Ä—Å–æ–Ω–∞–∂–∏: ${JSON.stringify(STATIC_CONFIG.characters, null, 2)}
                - –õ–æ–∫–∞—Ü–∏—è: ${STATIC_CONFIG.locations.join(', ')}
                - –í—Ä–µ–º—è: ${elements.time}
                - –°–∏–º–≤–æ–ª: ${elements.symbol}
                - –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ: ${elements.obstacle}
                - –°—Ç–∏–ª—å: 70% –•–æ—Ä—Ö–µ –õ—É–∏—Å –ë–æ—Ä—Ö–µ—Å, 30% –¥–µ—Ç–µ–∫—Ç–∏–≤`;
        }

        function validateContent(content) {
            const forbidden = ["–Ω–∞—Å–∏–ª–∏–µ", "–ø–æ–ª–∏—Ç–∏–∫–∞", "—Ä–µ–ª–∏–≥–∏—è"];
            return !forbidden.some(word => content.toLowerCase().includes(word));
        }

        // ======================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ======================
        async function initStory() {
            const name = document.getElementById('userName').value.trim();
            const age = document.getElementById('userAge').value;

            if (!name || !age || age < 8 || age > 100) {
                alert("üö® –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!\n–ò–º—è –∏ –≤–æ–∑—Ä–∞—Å—Ç (8-100)");
                return;
            }

            try {
                document.getElementById('userForm').style.display = 'none';
                document.getElementById('dynamic-content').innerHTML = "üîÆ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é...";

                const seed = generateSeed(name, age);
                localStorage.setItem('currentSeed', seed);
                
                const prompt = buildPrompt(seed);
                const story = await generateStoryContent(prompt);
                
                document.getElementById('dynamic-content').innerHTML = story;
                
            } catch (error) {
                document.getElementById('dynamic-content').innerHTML = 
                    `<p>‚õî –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        }

        // ======================
        // –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –°–ï–°–°–ò–ò
        // ======================
        window.onload = async () => {
            const savedSeed = localStorage.getItem('currentSeed');
            if (savedSeed) {
                document.getElementById('userForm').style.display = 'none';
                document.getElementById('dynamic-content').innerHTML = "üîç –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ...";
                try {
                    const story = await generateStoryContent(buildPrompt(savedSeed));
                    document.getElementById('dynamic-content').innerHTML = story;
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:", error);
                }
            }
        };
    </script>
</body>
</html>
